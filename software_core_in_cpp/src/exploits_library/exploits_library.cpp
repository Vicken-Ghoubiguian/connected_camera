#include <opencv2/opencv.hpp>
#include <opencv2/core.hpp>
#include <opencv2/videoio.hpp>
#include <opencv2/highgui.hpp>

#include "../usefull_functions_library/usefull_functions_library.hpp"
#include "../frame_mode_library/frame_mode_library.hpp"
#include "exploits_library.hpp"

using namespace cv;
using namespace usefull_functions;
using namespace frame_mode;

void exploits_function()
{
    int pressed_key;
    int mode;

    print_howto();

    VideoCapture cap;
    Mat frame, edge_detection_mode_frame;

    //Open the default camera
    cap.open(0);

    if(!cap.isOpened()) {

	//
        return ;
    }

    //We're entering an infinite loop...
    for(;;)
    {
        cap.read(frame);

	//
	pressed_key = waitKey(1);

	//If 'ESC' is pressed...
        if(pressed_key == 27)
	{

		break;

        }

	//If any alphabetic key (lower or upper case) is pressed...
	if((pressed_key >= 65 && pressed_key <= 90) || (pressed_key >= 97 && pressed_key <= 122))
	{

		mode = pressed_key;

	}

	//If 'y' is pressed...
        if(mode == 121)
        {

		frame = edge_detection_mode_function(frame);

        }
	//If 'p' is pressed...
	else if(mode == 112)
	{
		frame = cartoonizing_image_function(frame, 5, true);
	}
	//If 'a' is pressed...
	else if(mode == 97)
	{
		frame = black_and_white_frame_converting_function(frame, -1);
	}
	//if 'g' is pressed...
	else if(mode == 103)
	{
		frame = black_and_white_frame_converting_function(frame, CV_BGR2GRAY);
	}
	//If 'c' is pressed...
	else if(mode == 99)
	{
		frame = cartoonizing_image_function(frame, 5, false);
	}
	//If 'w' is pressed...
        else if(mode == 119)
        {
		frame = gray_and_white_effect_function(frame);
        }
	//If 'i' is pressed...
        else if(mode == 105)
        {

		frame = negative_or_inverted_effect_function(frame);

        }
	//If 'h' is pressed...
	else if(mode == 104)
	{
		frame = hue_saturation_lightness_effect_function(frame);
	}
	//If 'o' is pressed...
	else if(mode == 111)
	{
		frame = frame;
	}

	//Displaying the frame in a window...
        imshow("Connected camera", frame);
    }
}
